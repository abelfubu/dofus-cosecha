"use strict";(self.webpackChunkdofus_cosecha=self.webpackChunkdofus_cosecha||[]).push([[496],{4496:(L,m,i)=>{i.r(m),i.d(m,{ProfileComponent:()=>N});var t=i(2223),v=i(5855),l=i(9401),c=i(8255),f=i(2480),a=i(430),x=i(1864),p=i(4168),S=i(3144),C=i(2340);let Z=(()=>{class e{constructor(){this.URL=C.N.apiUrl,this.http=(0,t.f3M)(S.eN)}get(){return this.http.get(`${this.URL}/profile`)}put(o){return this.http.put(`${this.URL}/profile`,o)}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var d=i(3900);const _={profile:{email:"",discord:"",serverId:"",picture:"",activeAt:"",nickname:""},servers:[]};let g=(()=>{class e extends p.m1{constructor(){super(_),this.toast=(0,t.f3M)(x.jE),this.dataService=(0,t.f3M)(Z),this.router=(0,t.f3M)(f.F0),this.translate=(0,t.f3M)(a.Vn),this.vm$=this.select(o=>o),this.getData=this.effect(o=>o.pipe((0,d.w)(()=>this.dataService.get().pipe((0,p._b)(n=>this.setData(n),n=>console.log(n)))))),this.update=this.effect(o=>o.pipe((0,d.w)(n=>this.dataService.put(n).pipe((0,p._b)(()=>{this.router.navigate(["/",this.translate.getActiveLang()]),this.toast.success("Profile updated")},s=>console.log(s)))))),this.setData=this.updater((o,n)=>({...o,profile:n.profile,servers:n.servers}))}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})();var T=i(483),b=i(5266),y=i(872),u=i(4755);function U(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"button",4)(1,"div",5),t.NdJ("click",function(){const Y=t.CHM(o).$implicit,j=t.oxw();return t.KtG(j.onOptionSelect(Y))}),t._uU(2),t.qZA()()}if(2&e){const o=r.$implicit;t.xp6(2),t.hij(" ",o.label," ")}}function P(e,r){1&e&&(t.TgZ(0,"p"),t._uU(1,"El campo es obligatorio"),t.qZA())}function A(e,r){1&e&&(t.TgZ(0,"p"),t._uU(1,"Introduce un email v\xe1lido"),t.qZA())}function M(e,r){if(1&e&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&e){const o=t.oxw(2);t.xp6(1),t.hij(" El campo tiene que tener como m\xednimo ",null==o.control.errors?null:o.control.errors.max.max," caracteres ")}}function J(e,r){if(1&e&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&e){const o=t.oxw(2);t.xp6(1),t.hij(" El campo tiene que tener como m\xednimo ",null==o.control.errors?null:o.control.errors.min.min," caracteres ")}}function O(e,r){1&e&&(t.TgZ(0,"p"),t._uU(1," La contrase\xf1a debe tener como m\xednimo una letra min\xfascula, una letra may\xfascula y un n\xfamero o un simbolo "),t.qZA())}function I(e,r){if(1&e&&(t.ynx(0),t.YNc(1,P,2,0,"p",3),t.YNc(2,A,2,0,"p",3),t.YNc(3,M,2,1,"p",3),t.YNc(4,J,2,1,"p",3),t.YNc(5,O,2,0,"p",3),t.BQk()),2&e){const o=t.oxw();t.xp6(1),t.Q6J("ngIf",null==o.control.errors?null:o.control.errors.required),t.xp6(1),t.Q6J("ngIf",null==o.control.errors?null:o.control.errors.email),t.xp6(1),t.Q6J("ngIf",null==o.control.errors?null:o.control.errors.max),t.xp6(1),t.Q6J("ngIf",null==o.control.errors?null:o.control.errors.min),t.xp6(1),t.Q6J("ngIf",null==o.control.errors?null:o.control.errors.pattern)}}let D=(()=>{class e{constructor(){this.type="text",this.placeholder="",this.options=[]}onOptionSelect(o){this.control.setValue(o)}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-select"]],inputs:{control:"control",type:"type",placeholder:"placeholder",options:"options"},standalone:!0,features:[t.jDz],decls:5,vars:6,consts:[["autocomplete","off","readonly","",3,"mat-menu-trigger-for","type","formControl","placeholder"],["menu","matMenu"],["mat-menu-item","",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-menu-item",""],[1,"language-flag",3,"click"]],template:function(o,n){if(1&o&&(t._UZ(0,"input",0),t.TgZ(1,"mat-menu",null,1),t.YNc(3,U,3,1,"button",2),t.qZA(),t.YNc(4,I,6,5,"ng-container",3)),2&o){const s=t.MAs(2);t.Q6J("mat-menu-trigger-for",s)("type",n.type)("formControl",n.control)("placeholder",n.placeholder),t.xp6(3),t.Q6J("ngForOf",n.options),t.xp6(1),t.Q6J("ngIf",n.control.touched)}},dependencies:[u.ez,u.sg,u.O5,l.UX,l.Fj,l.JJ,l.oH,c.Tx,c.VK,c.OP,c.p6],styles:["[_nghost-%COMP%]{display:block;position:relative}input[_ngcontent-%COMP%]{color:#fffa;padding:.33rem .7rem;border-radius:.4rem;border:none;box-shadow:0 0 0 1px #50555e;font-size:1.2rem;outline:none;width:100%;background-color:transparent;transition:box-shadow .2s ease-in-out}input[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 2px #50555e;background-color:transparent}input[_ngcontent-%COMP%]:hover{box-shadow:0 0 0 2px #50555e}p[_ngcontent-%COMP%]{font-size:.7rem;position:absolute;bottom:-1.3rem}"]}),e})();var F=i(4004);const Q=function(){return[]},E=function(){return["/"]};function k(e,r){if(1&e){const o=t.EpF();t.TgZ(0,"form",1),t.NdJ("ngSubmit",function(){t.CHM(o);const s=t.oxw();return t.KtG(s.onSubmit())}),t.TgZ(1,"label"),t._uU(2,"Email"),t.qZA(),t._UZ(3,"app-input",2),t.TgZ(4,"label"),t._uU(5),t.qZA(),t._UZ(6,"app-input",3),t.TgZ(7,"label"),t._uU(8,"Discord"),t.qZA(),t._UZ(9,"app-input",3),t.TgZ(10,"label"),t._uU(11),t.qZA(),t._UZ(12,"app-select",4),t.TgZ(13,"div",5)(14,"app-button",6),t._uU(15),t.qZA(),t.TgZ(16,"app-button",7),t._uU(17),t.qZA()()()}if(2&e){const o=r.$implicit,n=t.oxw();let s;t.Q6J("formGroup",n.form),t.xp6(3),t.Q6J("readonly",!0)("control",n.form.controls.email),t.xp6(2),t.Oqu(o("profile.gameNick")),t.xp6(1),t.Q6J("control",n.form.controls.nickname),t.xp6(3),t.Q6J("control",n.form.controls.discord),t.xp6(2),t.Oqu(o("profile.server")),t.xp6(1),t.Q6J("control",n.form.controls.server)("options",(null==(s=n.vm())?null:s.servers)||t.DdM(13,Q)),t.xp6(2),t.Q6J("disabled",n.form.invalid),t.xp6(1),t.Oqu(o("profile.submit")),t.xp6(1),t.Q6J("routerLink",t.DdM(14,E)),t.xp6(1),t.Oqu(o("profile.back"))}}let N=(()=>{class e{constructor(){this.store=(0,t.f3M)(g),this.formBuilder=(0,t.f3M)(l.qu),this.vm=(0,v.O4)(this.store.vm$.pipe((0,F.U)(o=>({profile:o.profile,servers:o.servers.map(n=>new h(n))})))),this.form=this.formBuilder.group({email:["",[l.kI.required,l.kI.email]],discord:[""],server:[new h,l.kI.required],nickname:["",l.kI.required]}),(0,t.cEC)(()=>{this.form.setValue({email:this.vm()?.profile?.email||"",discord:this.vm()?.profile?.discord||"",nickname:this.vm()?.profile?.nickname||"",server:this.vm()?.servers.find(o=>o.value===this.vm()?.profile?.serverId)||null})})}ngOnInit(){this.store.getData()}onSubmit(){this.form.invalid||this.store.update({...this.vm()?.profile,discord:String(this.form.value.discord),nickname:String(this.form.value.nickname),serverId:String(this.form.value.server?.value)})}onServerSelect(o){this.form.controls.server.setValue(o)}}return e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=t.Xpm({type:e,selectors:[["ng-component"]],standalone:!0,features:[t._Bn([g]),t.jDz],decls:4,vars:0,consts:[[3,"formGroup","ngSubmit",4,"transloco"],[3,"formGroup","ngSubmit"],[3,"readonly","control"],[3,"control"],[3,"control","options"],[1,"actions"],[3,"disabled"],[3,"routerLink"]],template:function(o,n){1&o&&(t._UZ(0,"app-header"),t.TgZ(1,"h1"),t._uU(2,"Profile"),t.qZA(),t.YNc(3,k,18,15,"form",0))},dependencies:[l.UX,l._Y,l.JL,l.sg,y.a,T.r,c.Tx,b.G,D,f.rH,a.y4,a.KI],styles:["label[_ngcontent-%COMP%]{display:block;padding:1.5rem 0 .3rem}app-button[_ngcontent-%COMP%]{display:block;padding:1rem 0}.actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;gap:1rem;padding:1rem 0}"]}),e})();class h{constructor(r){this.value=r?.id||"",this.label=r?.name||""}toString(){return this.label}}}}]);